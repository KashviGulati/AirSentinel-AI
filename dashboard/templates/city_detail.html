<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Details - Smart AQI System</title>
    <link rel="stylesheet" href="../static/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            transition: background 0.3s ease;
        }
        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .city-hero {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        .city-hero-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .city-title {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        .city-subtitle {
            font-size: 1.125rem;
            opacity: 0.9;
        }
        .current-aqi-large {
            text-align: right;
        }
        .current-aqi-value {
            font-size: 4rem;
            font-weight: 700;
            line-height: 1;
        }
        .current-aqi-label {
            font-size: 1.25rem;
            opacity: 0.9;
        }
        .pollutant-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        .pollutant-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .pollutant-name {
            color: #757575;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        .pollutant-value {
            font-size: 2rem;
            font-weight: 700;
            color: #212121;
        }
        .pollutant-unit {
            font-size: 0.75rem;
            color: #757575;
        }
        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .trend-up {
            color: #DD2C00;
        }
        .trend-down {
            color: #00C853;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="index.html" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                </a>
            </div>
            <nav class="nav">
                <a href="#overview" class="nav-link active">Overview</a>
                <a href="#trends" class="nav-link">Trends</a>
                <a href="#stations" class="nav-link">Stations</a>
                <a href="#forecast" class="nav-link">Forecast</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- City Hero Section -->
            <div class="city-hero">
                <div class="city-hero-content">
                    <div>
                        <h1 class="city-title" id="city-name">Loading...</h1>
                        <p class="city-subtitle" id="city-state">State</p>
                    </div>
                    <div class="current-aqi-large">
                        <div class="current-aqi-value" id="city-aqi">--</div>
                        <div class="current-aqi-label" id="city-category">--</div>
                    </div>
                </div>
            </div>

            <!-- Overview Section -->
            <section id="overview" class="section">
                <h2 class="section-title">Current Pollutant Levels</h2>
                
                <div class="pollutant-grid" id="pollutant-grid">
                    <!-- Populated by JS -->
                </div>

                <!-- Health Advisory -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-heartbeat"></i> Health Advisory</h3>
                    </div>
                    <div class="card-body">
                        <div id="health-advisory">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Trends Section -->
            <section id="trends" class="section">
                <h2 class="section-title">Historical Trends</h2>
                
                <div class="card">
                    <div class="card-header">
                        <h3>AQI Trend (Last 7 Days)</h3>
                        <select id="trend-period" class="filter-select">
                            <option value="7">Last 7 Days</option>
                            <option value="30">Last 30 Days</option>
                            <option value="90">Last 90 Days</option>
                        </select>
                    </div>
                    <div class="card-body">
                        <canvas id="aqi-trend-chart" class="chart-container"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Pollutant Comparison</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="pollutant-comparison-chart" class="chart-container"></canvas>
                    </div>
                </div>
            </section>

            <!-- Stations Section -->
            <section id="stations" class="section">
                <h2 class="section-title">Monitoring Stations</h2>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Station-wise Data</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-wrapper">
                            <table class="data-table" id="stations-table">
                                <thead>
                                    <tr>
                                        <th>Station Name</th>
                                        <th>AQI</th>
                                        <th>Category</th>
                                        <th>PM2.5</th>
                                        <th>PM10</th>
                                        <th>Last Update</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="stations-tbody">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Forecast Section -->
            <section id="forecast" class="section">
                <h2 class="section-title">AQI Forecast</h2>
                
                <div class="info-banner">
                    <i class="fas fa-info-circle"></i>
                    <p>Forecast based on historical patterns and ML predictions</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Next 24 Hours Forecast</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="forecast-chart" class="chart-container"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Weekly Outlook</h3>
                    </div>
                    <div class="card-body">
                        <div id="weekly-outlook" class="pollutant-grid">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Smart AQI Monitoring System</p>
            <p>Data for <span id="footer-city">City</span> | Last Updated: <span id="last-update">--</span></p>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Loading city data...</p>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <script>
        // Get city from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const cityName = urlParams.get('city') || 'Delhi';

        // AQI Categories and Colors
        const AQI_CATEGORIES = {
            'Good': { color: '#00C853', advice: 'Air quality is satisfactory. Enjoy outdoor activities!' },
            'Satisfactory': { color: '#FFD600', advice: 'Air quality is acceptable. Sensitive individuals should consider limiting prolonged outdoor exertion.' },
            'Moderate': { color: '#FF6D00', advice: 'Unhealthy for sensitive groups. Reduce prolonged outdoor exertion.' },
            'Poor': { color: '#DD2C00', advice: 'Everyone may begin to experience health effects. Sensitive groups should avoid outdoor activities.' },
            'Very Poor': { color: '#7B1FA2', advice: 'Health alert! Everyone should limit outdoor activities.' },
            'Severe': { color: '#4A148C', advice: 'Health warnings of emergency conditions. Avoid all outdoor activities!' }
        };

        function getAQICategory(aqi) {
            if (aqi <= 50) return 'Good';
            if (aqi <= 100) return 'Satisfactory';
            if (aqi <= 200) return 'Moderate';
            if (aqi <= 300) return 'Poor';
            if (aqi <= 400) return 'Very Poor';
            return 'Severe';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadCityData();
            setupEventListeners();
        });

        async function loadCityData() {
            showLoading();
            try {
                // Simulate API call - replace with actual backend endpoint
                const cityData = generateSampleCityData(cityName);
                renderCityData(cityData);
            } catch (error) {
                console.error('Error loading city data:', error);
            } finally {
                hideLoading();
            }
        }

        function generateSampleCityData(city) {
            const aqi = Math.floor(Math.random() * 400) + 20;
            return {
                city: city,
                state: 'State Name',
                aqi: aqi,
                category: getAQICategory(aqi),
                pollutants: {
                    PM25: Math.floor(Math.random() * 150) + 10,
                    PM10: Math.floor(Math.random() * 200) + 20,
                    NO2: Math.floor(Math.random() * 100) + 10,
                    SO2: Math.floor(Math.random() * 80) + 5,
                    OZONE: Math.floor(Math.random() * 150) + 10,
                    CO: (Math.random() * 5 + 0.5).toFixed(1)
                },
                stations: Array.from({ length: 5 }, (_, i) => ({
                    name: `Station ${String.fromCharCode(65 + i)}`,
                    aqi: Math.floor(Math.random() * 400) + 20,
                    pm25: Math.floor(Math.random() * 150) + 10,
                    pm10: Math.floor(Math.random() * 200) + 20,
                    lastUpdate: new Date(Date.now() - Math.random() * 3600000).toISOString()
                })),
                historical: generateHistoricalData(30)
            };
        }

        function generateHistoricalData(days) {
            const data = [];
            for (let i = days; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                data.push({
                    date: date.toISOString(),
                    aqi: Math.floor(Math.random() * 300) + 50,
                    pm25: Math.floor(Math.random() * 150) + 10,
                    pm10: Math.floor(Math.random() * 200) + 20
                });
            }
            return data;
        }

        function renderCityData(data) {
            // Update hero section
            document.getElementById('city-name').textContent = data.city;
            document.getElementById('city-state').textContent = data.state;
            document.getElementById('city-aqi').textContent = data.aqi;
            document.getElementById('city-category').textContent = data.category;
            document.getElementById('footer-city').textContent = data.city;
            document.getElementById('last-update').textContent = new Date().toLocaleString('en-IN');

            // Apply color
            const color = AQI_CATEGORIES[data.category].color;
            document.getElementById('city-aqi').style.color = color;

            // Render pollutants
            renderPollutants(data.pollutants);
            
            // Render health advisory
            renderHealthAdvisory(data.category);
            
            // Render charts
            renderAQITrendChart(data.historical);
            renderPollutantComparison(data.pollutants);
            renderForecastChart();
            renderWeeklyOutlook();
            
            // Render stations
            renderStations(data.stations);
        }

        function renderPollutants(pollutants) {
            const grid = document.getElementById('pollutant-grid');
            const pollutantData = [
                { name: 'PM2.5', value: pollutants.PM25, unit: 'µg/m³', trend: Math.random() > 0.5 ? 'up' : 'down' },
                { name: 'PM10', value: pollutants.PM10, unit: 'µg/m³', trend: Math.random() > 0.5 ? 'up' : 'down' },
                { name: 'NO2', value: pollutants.NO2, unit: 'µg/m³', trend: Math.random() > 0.5 ? 'up' : 'down' },
                { name: 'SO2', value: pollutants.SO2, unit: 'µg/m³', trend: Math.random() > 0.5 ? 'up' : 'down' },
                { name: 'O3', value: pollutants.OZONE, unit: 'µg/m³', trend: Math.random() > 0.5 ? 'up' : 'down' },
                { name: 'CO', value: pollutants.CO, unit: 'mg/m³', trend: Math.random() > 0.5 ? 'up' : 'down' }
            ];

            grid.innerHTML = pollutantData.map(p => `
                <div class="pollutant-card">
                    <div class="pollutant-name">${p.name}</div>
                    <div class="pollutant-value">${p.value}</div>
                    <div class="pollutant-unit">${p.unit}</div>
                    <div class="trend-indicator trend-${p.trend}">
                        <i class="fas fa-arrow-${p.trend === 'up' ? 'up' : 'down'}"></i>
                        ${Math.floor(Math.random() * 15 + 1)}%
                    </div>
                </div>
            `).join('');
        }

        function renderHealthAdvisory(category) {
            const advisory = document.getElementById('health-advisory');
            const advice = AQI_CATEGORIES[category].advice;
            advisory.innerHTML = `
                <p style="font-size: 1.125rem; line-height: 1.8;">
                    <strong>${category} Air Quality</strong><br>
                    ${advice}
                </p>
            `;
        }

        function renderAQITrendChart(historical) {
            const ctx = document.getElementById('aqi-trend-chart');
            const last7Days = historical.slice(-7);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days.map(d => new Date(d.date).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })),
                    datasets: [{
                        label: 'AQI',
                        data: last7Days.map(d => d.aqi),
                        borderColor: '#1976D2',
                        backgroundColor: 'rgba(25, 118, 210, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function renderPollutantComparison(pollutants) {
            const ctx = document.getElementById('pollutant-comparison-chart');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['PM2.5', 'PM10', 'NO2', 'SO2', 'O3', 'CO'],
                    datasets: [{
                        label: 'Current Levels',
                        data: [pollutants.PM25, pollutants.PM10, pollutants.NO2, pollutants.SO2, pollutants.OZONE, pollutants.CO],
                        backgroundColor: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function renderForecastChart() {
            const ctx = document.getElementById('forecast-chart');
            const hours = Array.from({ length: 24 }, (_, i) => `${i}:00`);
            const forecast = Array.from({ length: 24 }, () => Math.floor(Math.random() * 200) + 50);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'Forecasted AQI',
                        data: forecast,
                        borderColor: '#FF6D00',
                        backgroundColor: 'rgba(255, 109, 0, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function renderWeeklyOutlook() {
            const outlook = document.getElementById('weekly-outlook');
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            
            outlook.innerHTML = days.map(day => {
                const aqi = Math.floor(Math.random() * 300) + 50;
                const category = getAQICategory(aqi);
                return `
                    <div class="pollutant-card">
                        <div class="pollutant-name">${day}</div>
                        <div class="pollutant-value" style="color: ${AQI_CATEGORIES[category].color}">${aqi}</div>
                        <span class="aqi-badge ${category.toLowerCase().replace(' ', '-')}">${category}</span>
                    </div>
                `;
            }).join('');
        }

        function renderStations(stations) {
            const tbody = document.getElementById('stations-tbody');
            tbody.innerHTML = stations.map(station => {
                const category = getAQICategory(station.aqi);
                return `
                    <tr>
                        <td><strong>${station.name}</strong></td>
                        <td><strong style="color: ${AQI_CATEGORIES[category].color}">${station.aqi}</strong></td>
                        <td><span class="aqi-badge ${category.toLowerCase().replace(' ', '-')}">${category}</span></td>
                        <td>${station.pm25}</td>
                        <td>${station.pm10}</td>
                        <td>${new Date(station.lastUpdate).toLocaleString('en-IN')}</td>
                        <td><span style="color: #00C853">●</span> Active</td>
                    </tr>
                `;
            }).join('');
        }

        function setupEventListeners() {
            // Smooth scrolling for navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const target = link.getAttribute('href');
                    document.querySelector(target)?.scrollIntoView({ behavior: 'smooth' });
                    
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                });
            });
        }

        function showLoading() {
            document.getElementById('loading-overlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.remove('active');
        }
    </script>
</body>
</html>